<!-- 
  Projeto: Leitura de Hidr√¥metro
  Vers√£o: v1.0.0
  Data: 10/11/2025
  Descri√ß√£o: Dashboard principal com lista de blocos.
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
  <title>Dashboard | Leitura de Hidr√¥metro</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="logorecibo.png" type="image/png">
</head>
<body>
  <script>
    if (localStorage.getItem("logado") !== "true") location.href = "index.html";
  </script>

  <header class="topbar">
    <h1>Blocos Cadastrados</h1>
    <div class="topbar-actions">
      <button type="button" onclick="abrirModalImpressaoRecibo()">üñ®Ô∏è Imprimir Recibo</button>
      <button type="button" onclick="criarBloco()">+ Adicionar Bloco</button>
      <button type="button" onclick="toggleCalculadora()">üßÆ Calculadora</button>
      
      <button type="button" onclick="exportarDadosJSON()">üíæ Exportar Dados (JSON)</button>
      <input type="file" id="import-json-input" accept=".json" onchange="importarDadosJSON(event)" style="display: none;">
      <button type="button" onclick="acionarImportacaoJSON()">üì• Importar Dados (JSON)</button>
		      <button type="button" onclick="gerarTemplateImportacao()">üìÑ Gerar Modelo Importa√ß√£o</button>
      <button type="button" onclick="abrirModalAlterarSenha()">üîë Alterar Senha</button>
      <button type="button" class="btn-danger" onclick="logout()">Sair</button>
      <button type="button" class="btn-danger" onclick="hardResetConfirm()">‚ö†Ô∏è Hard Reset</button>
    </div>
  </header>

  <main id="blocos-container">
    <div id="storage-counter" style="text-align: center; margin-bottom: 10px; font-size: 0.9em; color: #666;"></div>
    <div id="calculator-container" class="calculator-container" style="display:none;">
				      <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
				        <img src="logorecibo.png" alt="Logo" style="width: 50px; height: 50px; object-fit: contain;">
				        <h2>Calculadora de Conta de √Ågua</h2>
				      </div>
			      <p>Preencha os campos abaixo para calcular o valor da sua conta.</p>
		
			      <div class="input-group">
			        <label for="consumo">Consumo (m¬≥):</label>
			        <input type="number" id="consumo" placeholder="Ex: 15" onchange="calcularValor(); atualizarTextoExplicativo();" />
			      </div>
		
			      <div class="input-group">
			        <label for="valorMinimo">Valor M√≠nimo (R$):</label>
			        <input type="number" id="valorMinimo" step="0.01" value="68.40" onchange="calcularValor(); atualizarTextoExplicativo();" />
			      </div>
		
			      <div class="input-group">
			        <label for="valorM3">Valor por m¬≥ excedente (R$):</label>
			        <input type="number" id="valorM3" step="0.01" value="8.59" onchange="calcularValor(); atualizarTextoExplicativo();" />
			      </div>
		
			      <div class="input-group">
			        <label for="valorTotal">Total a pagar (R$):</label>
			        <input type="text" id="valorTotal" readonly />
			      </div>

          <div id="textoExplicativo" class="result-box"></div>

          <div>
			      <a id="whatsappLink" href="#" target="_blank">
			        <button>Enviar c√°lculo via WhatsApp</button>
			      </a>
			    </div>
		    </div>
    <div id="lista-blocos">

    </div>
  </main>

  <!-- Modal de Altera√ß√£o de Senha -->
  <div id="modal-alterar-senha" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close-button" onclick="fecharModalAlterarSenha()">&times;</span>
      <h2>Alterar Senha</h2>
      <form id="form-alterar-senha">
        <label for="nova-senha">Nova Senha:</label>
        <input type="password" id="nova-senha" required>
        <label for="confirmar-senha">Confirmar Nova Senha:</label>
        <input type="password" id="confirmar-senha" required>
        <button type="submit">Salvar Nova Senha</button>
      </form>
      <p id="senha-erro" style="color: red;"></p>
    </div>
  </div>

	  <!-- Modal de Impress√£o de Recibo (Sele√ß√£o) -->
	  <div id="modal-impressao-recibo" class="modal" style="display:none;">
	    <div class="modal-content">
	      <span class="close-button" onclick="fecharModalImpressaoRecibo()">&times;</span>
	      <h2>Imprimir Recibo por Bloco e M√™s</h2>
	      <form id="form-impressao-recibo" onsubmit="gerarReciboParaImpressao(event)">
	        <label for="select-bloco-recibo">Selecione o Bloco:</label>
	        <select id="select-bloco-recibo" required onchange="popularMesesRecibo()"></select>
	        
	        <label for="select-mes-recibo">Selecione o M√™s:</label>
	        <select id="select-mes-recibo" required></select>
	        
	        <button type="submit">Gerar Recibo para Impress√£o</button>
	      </form>
	    </div>
	  </div>
	
	  <!-- Modal de Visualiza√ß√£o/Impress√£o do Recibo -->
	  <div id="modal-visualizacao-recibo" class="modal" style="display:none;">
	    <div class="modal-content-recibo">
	      <span class="close-button" onclick="fecharModalVisualizacaoRecibo()">&times;</span>
	      
	      <div class="recibo-container" id="reciboContainer">
	        <div class="recibo-numero" id="reciboNumero">Recibo n¬∫ 01</div>
	        <div class="recibo-logo">
	          <img src="logorecibo.png" alt="Logo" />
	        </div>
	        <div class="recibo-header">
	          <span>Recibo de Pagamento</span>
	          <span id="valorFormatado">R$ 0,00</span>
	        </div>
	
	        <div class="recibo-body" id="reciboTexto"></div>
	
	        <div class="assinatura">
	          <div class="recibo-footer" id="reciboData"></div>
	          <div class="assinatura-wrapper">
	            <img src="assinatura.png" alt="Assinatura" class="assinatura-img" />
	            <hr />
	            <strong>RAFAEL WANDERLEY MELO</strong><br />
	            <small>(15) 9 9793-9699</small>
	          </div>
	        </div>
	      </div>
	
	      <div class="recibo-actions">
	        <button class="print-button" onclick="imprimirRecibo()">Imprimir</button>
	        <button class="export-pdf-button" onclick="exportarParaPDF()">Exportar para PDF</button>
	      </div>
	    </div>
	  </div>

  <script src="main.js"></script>
</body>
</html>
