<!-- 
  Projeto: Leitura de Hidr√¥metro
  Vers√£o: v1.1.0
  Data: 10/11/2025
  Descri√ß√£o: Adiciona simulador de c√°lculo de consumo (modo modal) na tela do bloco.
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Leituras do Bloco | Leitura de Hidr√¥metro</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <script>
    if (localStorage.getItem("logado") !== "true") location.href = "index.html";
  </script>

  <div class="toolbar">
    <button class="voltar" aria-label="Voltar para o painel" onclick="window.location.href='dashboard.html'">üîô Voltar</button>
    <div class="acoes">
      <button type="button" onclick="exportarLeituraAtual()">üì§ Exportar Leitura Atual</button>
      <input type="file" id="importar-leitura-arquivo" accept=".xlsx" style="display:none" onchange="importarLeituraAtual(event)" />
      <button type="button" onclick="document.getElementById('importar-leitura-arquivo').click()">üì• Importar Leitura Atual (XLSX)</button>
      <button type="button" class="btn-danger" onclick="resetarBlocoPerguntar()">üóëÔ∏è Resetar Bloco</button>
      <button type="button" onclick="(function(){ const id=new URLSearchParams(location.search).get('id'); location.href='boletos.html?id='+encodeURIComponent(id||'0'); })()">üßæ Boletos (imprimir)</button>
      <button type="button" class="btn-simular" onclick="abrirSimulador()">üßÆ Simular Conta</button>
    </div>
  </div>

  <main id="bloco-detalhes" class="conteudo"></main>

  <!-- ===== Modal do Simulador ===== -->
  <div id="modal-simulador" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharSimulador()">&times;</span>
      <h2>Calculadora de Conta de √Ågua</h2>

      <div class="input-group">
        <label for="consumo">Consumo (m¬≥):</label>
        <input type="number" id="consumo" placeholder="Ex: 16" step="any">
      </div>

      <div class="input-group">
        <label for="minimo">Valor M√≠nimo (R$):</label>
        <input type="number" id="minimo" placeholder="Ex: 68.40" step="any">
      </div>

      <div class="input-group">
        <label for="valorM3">Valor por m¬≥ Excedente (R$):</label>
        <input type="number" id="valorM3" placeholder="Ex: 8.59" step="any">
      </div>

      <button onclick="calcularSimulador()">Calcular</button>

      <div id="resultado-simulador" class="resultado-simulador">
        O valor total aparecer√° aqui.
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
  <script>
    // ======== Fun√ß√µes do Simulador ========
    function abrirSimulador() {
      document.getElementById("modal-simulador").style.display = "flex";
    }

    function fecharSimulador() {
      document.getElementById("modal-simulador").style.display = "none";
    }

    function calcularSimulador() {
      const consumo = parseFloat(document.getElementById("consumo").value);
      const minimo = parseFloat(document.getElementById("minimo").value);
      const valorM3 = parseFloat(document.getElementById("valorM3").value);
      const elementoResultado = document.getElementById("resultado-simulador");

      if (isNaN(consumo) || isNaN(minimo) || isNaN(valorM3)) {
        elementoResultado.textContent = "Por favor, preencha todos os campos corretamente.";
        elementoResultado.style.color = "red";
        return;
      }

      let valorTotal;
      if (consumo <= 10) {
        valorTotal = minimo;
      } else {
        valorTotal = (consumo - 10) * valorM3 + minimo;
      }

      elementoResultado.textContent = "Valor Total: " + valorTotal.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
      elementoResultado.style.color = "#333";
    }

    // Fecha modal clicando fora
    window.onclick = function(e) {
      const modal = document.getElementById("modal-simulador");
      if (e.target === modal) fecharSimulador();
    }
  </script>
</body>
</html>
